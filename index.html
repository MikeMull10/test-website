<!DOCTYPE html>
<html>
    <head>
        <title>RSC Demo Website</title>
        <link rel="stylesheet" type="text/css" href="./style.css">
        <link rel="shortcut icon" type="image/x-icon" href="./RSC-Icon.ico"/>
        <script src="https://kit.fontawesome.com/810972f47f.js" crossorigin="anonymous"></script>
        <script src="./navbar.js"></script>
    </head>
    <button id="nav-btn" onclick="switchNav()">
       <i id="n" class="fa-solid fa-arrow-right fa-2xl"></i>
    </button>
    <div id="nav" class="navbar">
        <a href="https://discord.com/api/oauth2/authorize?client_id=1044633768360693790&redirect_uri=https%3A%2F%2Fmulligan-test-website.onrender.com%2F&response_type=token&scope=identify">LOGIN</a>
    </div>
    <div id="move" class="outer-container">
        <div class="middle-container">
            <div class="inner-container">
                <div class="card-container">
                    <div class="card logo">
                        <img src="" id="avatar">
                    </div>
                    <div class="card name">
                        <h1 id="username"></h1>
                        <h2 id="franchise"></h2>
                        <h3 id="team"></h3>
                    </div>
                    <div class="card stats" id="info">
                        Loading...
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script>
        window.onload = () => {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const [accessToken, tokenType] = [fragment.get('access_token'), fragment.get('token_type')];

            if (!accessToken) {return console.log("NO ACCESS TOKEN");}

            fetch('https://discord.com/api/users/@me', {
                headers: {
                    authorization: `${tokenType} ${accessToken}`,
                },
            })
            .then(result => result.json())
            .then(response => {
                console.log(response);
                const {username, discriminator, avatar, id} = response;

                //set the welcome username string
                document.getElementById('username').innerText = `${username}#${discriminator}`;

                //set the avatar image by constructing a url to access discord's cdn
                document.getElementById("avatar").src = `https://cdn.discordapp.com/avatars/${id}/${avatar}.jpg`;

                document.getElementById("info").innerText = "Successfully loaded discord info.";

                $.getJSON("Data.json", function (data) {
                    if (!Object.keys(data).includes(id)) return;
                    window.player_data = data[id];
                    console.log("TEST 1: ", window.player_data);

                    document.getElementById("franchise").innerText = window.player_data["Franchise"];
                    document.getElementById("team").innerText = window.player_data["Team"];
                    console.log("Franchise and Team Data Loaded.");
                });
                console.log("TEST 2: ", window.player_data);
            })
            .catch(console.error);
        }
    </script>
    <script>
        var globalOne = 3;
        testOne();

        function testOne() {
            globalOne += 2;
            alert("globalOne is :" + globalOne );
            globalOne += 1;
        }

        alert("outside globalOne is: " + globalOne);

        testTwo();

        function testTwo() {
            globalTwo = 20;
            alert("globalTwo is " + globalTwo);
            globalTwo += 5;
        }

        alert("outside globalTwo is:" + globalTwo);
    </script>
</html>